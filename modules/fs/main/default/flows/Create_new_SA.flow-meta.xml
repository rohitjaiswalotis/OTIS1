<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>AssignRecordValuesForUpdate</name>
        <label>AssignRecordValuesForUpdate</label>
        <locationX>314</locationX>
        <locationY>2906</locationY>
        <assignmentItems>
            <assignToReference>SA_to_create.WorkOrder__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>None</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.Initial_ETA__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Initial_ETA_Field</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.WorkTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>WorkType.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.DueDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>DueDate1</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.ParentRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.Subject</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Subject</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.EarliestStartTime</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Earliest_Start_Permitted</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.ArrivalWindowStartTime</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Arrival_Window_Start</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SA_to_create.ArrivalWindowEndTime</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Arrival_Window_End</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Service_Appointment_Record</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>DueDateValue</name>
        <label>DueDateValue</label>
        <locationX>50</locationX>
        <locationY>2714</locationY>
        <assignmentItems>
            <assignToReference>DueDate1</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>duedatecapture1</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AssignRecordValuesForUpdate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>dueDateValue1</name>
        <label>dueDateValue</label>
        <locationX>314</locationX>
        <locationY>2714</locationY>
        <assignmentItems>
            <assignToReference>DueDate1</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>duedatecapture2</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AssignRecordValuesForUpdate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>get_Open_SA_Count</name>
        <label>get Open SA Count</label>
        <locationX>578</locationX>
        <locationY>1298</locationY>
        <assignmentItems>
            <assignToReference>openSAcount</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SA_Iteration</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Data_Or_Not</name>
        <label>Check Data Or Not</label>
        <locationX>314</locationX>
        <locationY>1574</locationY>
        <defaultConnector>
            <targetReference>Show_Error</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Open SA exists</defaultConnectorLabel>
        <rules>
            <name>Open_SA_exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>openSAcount</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>WorkOrderRecord.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cannot Complete</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>WorkOrderRecord.TrappedPassengerReleasedByOTIS__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>WorkOrderRecord.Reason__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Need New Visit On Site</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_Work_order_Details</targetReference>
            </connector>
            <label>Open SA doesn&apos;t exist</label>
        </rules>
        <rules>
            <name>Open_SA_doesnt_exists_with_mechanic_reason</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>openSAcount</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>WorkOrderRecord.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cannot Complete</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>WorkOrderRecord.TrappedPassengerReleasedByOTIS__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>WorkOrderRecord.Reason__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Additional Skills Needed</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>recordId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_Work_order_Details</targetReference>
            </connector>
            <label>Open SA doesnt exists with mechanic reason</label>
        </rules>
    </decisions>
    <decisions>
        <name>check_Duration_Type</name>
        <label>check Duration Type</label>
        <locationX>314</locationX>
        <locationY>2606</locationY>
        <defaultConnector>
            <targetReference>AssignRecordValuesForUpdate</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Hours</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>WorkType.DurationType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Hours</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>DueDateValue</targetReference>
            </connector>
            <label>Hours</label>
        </rules>
        <rules>
            <name>Minutes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>WorkType.DurationType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Minutes</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>dueDateValue1</targetReference>
            </connector>
            <label>Minutes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Id_is_null_or_not</name>
        <label>Check Id is null or not</label>
        <locationX>666</locationX>
        <locationY>134</locationY>
        <defaultConnector>
            <targetReference>Copy_1_of_Get_Work_Order_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_not_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Work_Order_Record</targetReference>
            </connector>
            <label>If not null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Work_order_Details</name>
        <label>Check Work order Details</label>
        <locationX>314</locationX>
        <locationY>1982</locationY>
        <defaultConnector>
            <targetReference>Copy_1_of_Update_Work_Order_Record</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Check_Condition</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>WorkOrderRecord.Priority</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>S1 - Emergency</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>UnitRecord.FS_ProductionUnitMaintenance__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Work_Order_Record</targetReference>
            </connector>
            <label>Check Condition</label>
        </rules>
    </decisions>
    <decisions>
        <name>Open_Appointments</name>
        <label>Open Appointments ?</label>
        <locationX>490</locationX>
        <locationY>1190</locationY>
        <defaultConnector>
            <targetReference>get_Open_SA_Count</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>canceled_cannot_completed</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Service_Appointment_Record.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Canceled</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Service_Appointment_Record.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Cannot Complete</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Service_Appointment_Record.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Completed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>SA_Iteration</targetReference>
            </connector>
            <label>canceled , cannot completed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Preference_Exists</name>
        <label>Preference Exists</label>
        <locationX>314</locationX>
        <locationY>3230</locationY>
        <defaultConnector>
            <targetReference>SA_auto_schedule</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>PreferenceID</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Preferred_Resource_Set</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <name>Record_type_check</name>
        <label>Record type check</label>
        <locationX>666</locationX>
        <locationY>542</locationY>
        <defaultConnector>
            <targetReference>error</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>is_SR</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>RecordType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Service_Request</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Unit_Record</targetReference>
            </connector>
            <label>is SR</label>
        </rules>
    </decisions>
    <decisions>
        <name>SA_auto_schedule</name>
        <label>SA auto schedule</label>
        <locationX>314</locationX>
        <locationY>3530</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>is_Supv</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>recordId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_SA_record</targetReference>
            </connector>
            <label>is Supv</label>
        </rules>
    </decisions>
    <description>#921525  FS - FSL Mechanic worked on S1 Service request self assigns incomplete downgraded Service request.</description>
    <environments>Default</environments>
    <formulas>
        <name>CurrentUserId</name>
        <dataType>String</dataType>
        <expression>{!$User.Id}</expression>
    </formulas>
    <formulas>
        <name>duedatecapture1</name>
        <dataType>DateTime</dataType>
        <expression>{!Earliest_Start_Permitted} + {!WorkType.EstimatedDuration}/24</expression>
    </formulas>
    <formulas>
        <name>duedatecapture2</name>
        <dataType>DateTime</dataType>
        <expression>{!Earliest_Start_Permitted}+ {!WorkType.EstimatedDuration} /(24*60)</expression>
    </formulas>
    <interviewLabel>Create New {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Create new SA</label>
    <loops>
        <name>SA_Iteration</name>
        <label>SA Iteration</label>
        <locationX>314</locationX>
        <locationY>1082</locationY>
        <assignNextValueToReference>Service_Appointment_Record</assignNextValueToReference>
        <collectionReference>ServiceAppointmentRecord</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Open_Appointments</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Check_Data_Or_Not</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>FieldServiceMobile</processType>
    <recordCreates>
        <name>Create_Service_Appointment_Record</name>
        <label>Create Service Appointment Record</label>
        <locationX>314</locationX>
        <locationY>3014</locationY>
        <connector>
            <targetReference>Get_Resource_Preference_if_any</targetReference>
        </connector>
        <faultConnector>
            <targetReference>err</targetReference>
        </faultConnector>
        <inputReference>SA_to_create</inputReference>
    </recordCreates>
    <recordCreates>
        <name>Preferred_Resource_Set</name>
        <label>Preferred Resource Set</label>
        <locationX>182</locationX>
        <locationY>3338</locationY>
        <connector>
            <targetReference>SA_auto_schedule</targetReference>
        </connector>
        <inputAssignments>
            <field>PreferenceType</field>
            <value>
                <stringValue>Preferred</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelatedRecordId</field>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ServiceResourceId</field>
            <value>
                <elementReference>ServiceResourceId</elementReference>
            </value>
        </inputAssignments>
        <object>ResourcePreference</object>
    </recordCreates>
    <recordLookups>
        <name>Copy_1_of_Get_Work_Order_Record</name>
        <label>Copy 1 of Get Work Order Record</label>
        <locationX>798</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>RecordType_Name</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Cannot Complete</stringValue>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <object>WorkOrder</object>
        <outputReference>WorkOrderRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>AssetId</queriedFields>
        <queriedFields>ParentWorkOrderId</queriedFields>
        <queriedFields>OwnerId</queriedFields>
        <queriedFields>ServiceTerritoryId</queriedFields>
        <queriedFields>Subject</queriedFields>
        <queriedFields>Description</queriedFields>
        <queriedFields>ETAByMechanicDateTime__c</queriedFields>
        <queriedFields>FS_Priority__c</queriedFields>
        <queriedFields>WorkTypeId</queriedFields>
        <queriedFields>WorkOrderNumber</queriedFields>
        <queriedFields>Priority</queriedFields>
        <queriedFields>LastModifiedById</queriedFields>
        <queriedFields>TrappedPassengerReleasedByOTIS__c</queriedFields>
        <queriedFields>Reason__c</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Assigned_Resource_of_Latest_SA</name>
        <label>Get Assigned Resource of Latest SA</label>
        <locationX>314</locationX>
        <locationY>2390</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>SA_Details</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>LatestSA.AssignedServiceResource__c</elementReference>
            </value>
        </filters>
        <object>ServiceResource</object>
        <outputAssignments>
            <assignToReference>ServiceResourceId</assignToReference>
            <field>Id</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>get_Latest_SA</name>
        <label>get Latest SA</label>
        <locationX>314</locationX>
        <locationY>2282</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Assigned_Resource_of_Latest_SA</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </filters>
        <object>ServiceAppointment</object>
        <outputReference>LatestSA</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Subject</queriedFields>
        <queriedFields>Description</queriedFields>
        <queriedFields>AssignedServiceResource__c</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Resource_Preference_if_any</name>
        <label>Get Resource Preference if any</label>
        <locationX>314</locationX>
        <locationY>3122</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Preference_Exists</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RelatedRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>PreferenceType</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Preferred</stringValue>
            </value>
        </filters>
        <object>ResourcePreference</object>
        <outputAssignments>
            <assignToReference>PreferenceID</assignToReference>
            <field>Id</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Service_Appointment_Record</name>
        <label>Get Service Appointment Record</label>
        <locationX>314</locationX>
        <locationY>974</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>SA_Iteration</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentRecordId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </filters>
        <object>ServiceAppointment</object>
        <outputReference>ServiceAppointmentRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Service_Territory</name>
        <label>Get Service Territory</label>
        <locationX>314</locationX>
        <locationY>758</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Work_Type</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.ServiceTerritoryId</elementReference>
            </value>
        </filters>
        <object>ServiceTerritory</object>
        <outputReference>Route1</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Unit_Record</name>
        <label>Get Unit Record</label>
        <locationX>314</locationX>
        <locationY>650</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Service_Territory</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.AssetId</elementReference>
            </value>
        </filters>
        <object>Asset</object>
        <outputReference>UnitRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Street</queriedFields>
        <queriedFields>State</queriedFields>
        <queriedFields>PostalCode</queriedFields>
        <queriedFields>Country</queriedFields>
        <queriedFields>City</queriedFields>
        <queriedFields>FS_ProductionUnitMaintenance__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Work_Order_Record</name>
        <label>Get Work Order Record</label>
        <locationX>534</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>RecordType_Name</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Cannot Complete</stringValue>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <object>WorkOrder</object>
        <outputReference>WorkOrderRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>AssetId</queriedFields>
        <queriedFields>ParentWorkOrderId</queriedFields>
        <queriedFields>OwnerId</queriedFields>
        <queriedFields>ServiceTerritoryId</queriedFields>
        <queriedFields>Subject</queriedFields>
        <queriedFields>Description</queriedFields>
        <queriedFields>ETAByMechanicDateTime__c</queriedFields>
        <queriedFields>FS_Priority__c</queriedFields>
        <queriedFields>WorkTypeId</queriedFields>
        <queriedFields>WorkOrderNumber</queriedFields>
        <queriedFields>Priority</queriedFields>
        <queriedFields>LastModifiedById</queriedFields>
        <queriedFields>TrappedPassengerReleasedByOTIS__c</queriedFields>
        <queriedFields>Reason__c</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Work_Type</name>
        <label>Get Work Type</label>
        <locationX>314</locationX>
        <locationY>866</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Service_Appointment_Record</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.WorkTypeId</elementReference>
            </value>
        </filters>
        <object>WorkType</object>
        <outputReference>WorkType</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>EstimatedDuration</queriedFields>
        <queriedFields>DurationType</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>RecordType_Name</name>
        <label>RecordType Name</label>
        <locationX>666</locationX>
        <locationY>434</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Record_type_check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.RecordTypeId</elementReference>
            </value>
        </filters>
        <object>RecordType</object>
        <outputAssignments>
            <assignToReference>RecordType</assignToReference>
            <field>DeveloperName</field>
        </outputAssignments>
    </recordLookups>
    <recordUpdates>
        <name>Copy_1_of_Update_Work_Order_Record</name>
        <label>Copy 1 of Update Work Order Record</label>
        <locationX>446</locationX>
        <locationY>2090</locationY>
        <connector>
            <targetReference>get_Latest_SA</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>AssignmentType__c</field>
            <value>
                <stringValue>Auto</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FS_Priority__c</field>
            <value>
                <stringValue>S3</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Priority</field>
            <value>
                <stringValue>S3 - Normal</stringValue>
            </value>
        </inputAssignments>
        <object>WorkOrder</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_SA_record</name>
        <label>Update SA record</label>
        <locationX>182</locationX>
        <locationY>3638</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SA_to_create.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>FSL__Auto_Schedule__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>ServiceAppointment</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Work_Order_Record</name>
        <label>Update Work Order Record</label>
        <locationX>182</locationX>
        <locationY>2090</locationY>
        <connector>
            <targetReference>get_Latest_SA</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>AssignmentType__c</field>
            <value>
                <stringValue>Auto</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FS_Priority__c</field>
            <value>
                <stringValue>S2</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Priority</field>
            <value>
                <stringValue>S2 - High</stringValue>
            </value>
        </inputAssignments>
        <object>WorkOrder</object>
    </recordUpdates>
    <screens>
        <name>err</name>
        <label>Error</label>
        <locationX>754</locationX>
        <locationY>3122</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>errortext</name>
            <fieldText>&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>error</name>
        <label>New SA process</label>
        <locationX>1018</locationX>
        <locationY>650</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>text</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;This Action only works for Service Request WO-SA and WO Status should be &apos;Cannot Complete&apos;.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>SA_Details</name>
        <label>SA Details</label>
        <locationX>314</locationX>
        <locationY>2498</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>check_Duration_Type</targetReference>
        </connector>
        <fields>
            <name>ParentRecord</name>
            <fieldText>&lt;p&gt;Parent Record : {!WorkOrderRecord.WorkOrderNumber}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Status</name>
            <fieldText>&lt;p&gt;Status : None&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Route</name>
            <fieldText>&lt;p&gt;Route : {!Route1.Name}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Unit</name>
            <fieldText>&lt;p&gt;Unit : {!UnitRecord.Name}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Subject</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>LatestSA.Subject</elementReference>
            </defaultValue>
            <fieldText>Subject</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Description</name>
            <defaultValue>
                <stringValue>{!LatestSA.Description}</stringValue>
            </defaultValue>
            <fieldText>Description</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>Initial_ETA_Field</name>
            <dataType>DateTime</dataType>
            <fieldText>Initial ETA Field</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;Initial ETA should not be greater than Arrival Window End.&lt;/p&gt;</errorMessage>
                <formulaExpression>{!Initial_ETA_Field} &lt; {!Arrival_Window_End} || ISBLANK({!Arrival_Window_End})</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>Earliest_Start_Permitted</name>
            <dataType>DateTime</dataType>
            <fieldText>Earliest Start Permitted</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Arrival_Window_Start</name>
            <dataType>DateTime</dataType>
            <fieldText>Arrival Window Start</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>Arrival_Window_End</name>
            <dataType>DateTime</dataType>
            <fieldText>Arrival Window End</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>Duration</name>
            <fieldText>&lt;p&gt;Duration : {!WorkType.EstimatedDuration} {!WorkType.DurationType}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <nextOrFinishButtonLabel>Create</nextOrFinishButtonLabel>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Show Error on not present work order</description>
        <name>Show_Error</name>
        <label>SA creation not allowed</label>
        <locationX>490</locationX>
        <locationY>1682</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>ErrorMessage</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;New SA creation is not allowed. Please review Work Order or existing Service Appointment Status.&lt;/strong&gt;&lt;span style=&quot;color: rgb(0, 0, 0);&quot;&gt;﻿&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>540</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Check_Id_is_null_or_not</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>DueDate1</name>
        <dataType>DateTime</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ETADate</name>
        <dataType>DateTime</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>$Flow.CurrentDateTime</elementReference>
        </value>
    </variables>
    <variables>
        <name>Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>LatestSA</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <name>newSAcreated</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <name>openSAcount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>Owner</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>PreferenceID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>RecordType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Route1</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceTerritory</objectType>
    </variables>
    <variables>
        <name>SA_to_create</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <name>Service_Appointment_Record</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <name>ServiceAppointmentRecord</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <name>ServiceResourceData</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceResource</objectType>
    </variables>
    <variables>
        <name>ServiceResourceId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>UnitRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Asset</objectType>
    </variables>
    <variables>
        <name>workOrder1</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
    <variables>
        <name>WorkOrderRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
    <variables>
        <name>WorkType</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkType</objectType>
    </variables>
</Flow>
