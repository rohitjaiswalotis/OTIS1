
String myDomainHostname = DomainCreator.getOrgMyDomainHostname();

String myDomainName = 
	DomainParser.parse(
		myDomainHostname
	).getMyDomainName()
;

String optimizationUserName = 
	'fsl.' + UserInfo.getOrganizationId().left(15) 
	+ '@' 
	+ myDomainName 
	+ (
		myDomainName.contains('.') 
		? 
			'' 
			: 
			'.' + myDomainHostname.substringAfterLast('.')
	)
;


// early exit - optimization user already exists
Id existentOptimizationUserId = [ SELECT Id FROM User WHERE UserName = :optimizationUserName ]?.Id;

if ( existentOptimizationUserId != null ) {
	return;
}


User usr = 
	new User(
		Username			=		optimizationUserName,
		Email				=		UserInfo.getUserEmail(),
		FirstName			=		null,
		LastName			=		'FSL Optimization',
		Alias				=		'optuser',
		CommunityNickname	=		'optuser',
		ProfileId 			= 		getProfileId('FSL Optimization'),
		UserRoleId 			= 		null,
		IsActive			= 		true,
		/*
		CompanyName			=		'AutoGenerated',
		Title 				=		'Mr',
		Street 				=		'Optimization Street',
		Phone 				= 		'000000',
		MobilePhone 		= 		'000001',
		*/
		TimeZoneSidKey 		= 		'America/Los_Angeles',
		EmailEncodingKey 	= 		'UTF-8',
		LanguageLocaleKey	=		'en_US',
		LocaleSidKey 		= 		'en_US'
	)
;

insert usr;


private static Id getProfileId(String name) {
	return [ SELECT Id, Name FROM Profile WHERE Name = :name ]?.Id;
}


